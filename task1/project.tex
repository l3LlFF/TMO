\documentclass[12pt, a4paper]{article}

% Поля страницы
\usepackage{geometry}
\geometry{left=2cm}
\geometry{right=1cm}
\geometry{top=2cm}
\geometry{bottom=2cm}

%Package mandatory for each paper\
\usepackage{listings}
\usepackage{indentfirst}
\usepackage[cp1251]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{amsbsy}
\usepackage{comment} 
\usepackage[pdftex]{graphicx}
\usepackage{epstopdf}
\usepackage{scalefnt}
\newtheorem{thm}{Theorem}
\newtheorem{lem}{Lemma}
\newcommand{\thb}{{\boldsymbol \theta}}
\newcommand{\eb}{{\bf e}}
\newcommand{\nut}{\nu_t, \: t \geq 0}
\newcommand{\pib}{{\boldsymbol \pi}}
\newcommand{\pb}{{\bf p}}
\def\bs{\boldsymbol}
%Packages required by this paper
\usepackage{rotating, longtable, hhline}
\usepackage{amsmath, amsfonts, amssymb, amsthm}
\begin{document}
\begin{titlepage}
\begin{center}
  \textbf{\uppercase{Министерство Образования Республики Беларусь}}
\end{center}
\begin{center}
  \textbf{\uppercase{Белорусский Государственный Университет}}
\end{center}
\begin{center}
  \textbf{Факультет прикладной математики и информатики}
\end{center}
\begin{center}
  Кафедра теории вероятностей и математической статистики
\end{center}
\vfill


\begin{center}
  \uppercase{\large{\bf{теория массового обслуживания}}}
\end{center}
\begin{center}
  \uppercase{отчет по спецлабораторной работе}
\end{center}
\begin{center}
 	Задание №3
\end{center}

\vfill
\vfill
\hspace*{\fill}  \textbf{Выполнили студенты 3 курса 7 группы} \newline
\hspace*{\fill} Бокша В. А. \newline 
\hspace*{\fill}  Горохович У. Ю. \newline 
\hspace*{\fill} Лещенко Я. С. \newline 
\hspace*{\fill}  Шапиро И. А. \newline 


 \hspace*{\fill} \textbf{Руководитель}\newline
\hspace*{\fill}  \textit{Дудин Александр Николаевич}\newline
\hspace*{\fill}  доктор физико-математических наук, профессор
\vfill
\vfill
\begin{center}Минск 2020\end{center}
\end{titlepage}
\setcounter{page}{2}

\tableofcontents
\newpage

%-------------------------------------- ВВЕДЕНИЕ ----------------------------------------

\begin{center} {\bf {ВВЕДЕНИЕ}} \end{center}

Взрывной рост использования мобильных цифровых устройств поставил большие проблемы при проектировании и внедрении WLAN. Постоянно растущий спрос на высокоскоростную и повсеместную цифровую
связь сделал WLAN неотъемлемой частью повседневной жизни. А поскольку обмен аудио- и видеофайлами формируeт самый высокий процент трафика, генерируемого мультимедийными
приложениями, cледовательно, огромный спрос предъявляется к высокоскоростным WLAN, которые обеспечивают QoS и могут удовлетворить потребности конечного пользователя при относительно низких затратах.
Предоставление видео-и аудиоконтента конечным пользователям на удовлетворительном уровне с различным качеством канала требует тщательного изучения свойств такого трафика. 

Системы массового обслуживания, в которых заявки прибывают в группах имеют широкое применение в телекоммуникационных сетях. Большинство сетей имеют нестационарный (бурный), самоподобный входной поток, в котором время между прибытиями сильно коррелировано. Бурный трафик, действительно, появляется в телекоммуникационных сетях, таких как сети мультиплексирования с ортогональным частотным разделением (OFDM), которое объединяет несколько сигналов, работающих одновременно на разных частотах. Эти частоты известны как поднесущие или тоны. Если однонесущие системы подобны отдельным нотам в музыке, воспроизводимой быстро, OFDM объединяет несколько тонов и аккорд,  которые затем воспроизводит одновременно в течение более длительного периода.

$BMAP$-поток играет важную роль в
мире стохастического моделирования, как с теоретической, так и с практической точки зрения, поскольку она
допускает зависимое и неэкспоненциально распределенное время между событиями. Кроме того,
он может также включать в себя коррелированные события в группах. Эта универсальность делает $BMAP$ подходящим для моделирования различных реальных процессов. Кроме того, $BMAP$ является обобщением Марковских процессов и, следовательно, аналитически поддается обработке. 

Теория массового обслуживания рассматривает много различных систем, в том числе с групповым марковским потоком. В данной работе мы рассмотрим системы с непрерывным и вырожденным распределениями времени обслуживания заявок и изучим их поведение, проведя численные эксперименты.

\begin{figure}[htb] \centering
\includegraphics[scale=0.6]{img/birds.png}
\end{figure}


\newpage


\section{Постановка задачи}

%-------------------------------------- Описание системы ----------------------------------------

\subsection{Описание системы}

Рассматривается система $BMAP/G/1$ -- это однолинейная СМО с бесконечным буфером, на вход которой поступает $BMAP$-поток запросов. Данный поток характеризуется упрвляющим процессом $t_0$, с пространством состояний $\{0, 1,..., W\}$ и матричной ПФ $D(z)$. Времена обслуживания заявок взаимно независимы и характеризуются ФР $B(t)$ с ПЛС $\beta(s)$ и конечными начальными моментами $b_k$.

	Управляющий процесс $BMAP$-потока имеет пространство состояний $\{0, 1, 2, 3\}$, то есть $W=3$, а поведение потока описывается матрицами вида
	
	   $$D_0=\left(
    \begin{array}{cccc}
    -1,45& 0,2& 0,15& 0,1\\
    0,2& -2,6& 0,1& 0,3\\
    0,2& 0,1& -3,7& 0,4\\
    0,1& 0,05& 0,15& -4,3\\
    \end{array}
    \right),$$
    
    $$D_1=D_2=diag\{0,5; 1; 1,5; 2\}$$

Время пребывания управляющего процесса , в состояниях 
$\{0, 1, 2, 3\}$ имеют экспоненциальное распределение с параметрами $\{1,45; 2,6; 3,7; 4,3\}$ соответственно. В моменты скачков процесса либо происходит “холостой” переход в другое состояние (переход без генерации заявок), либо с равной вероятностью поступает одна или две заявки и процесс , сохраняет свое состояние до следующего момента скачка.
Необходимо реализовать алгоритм нахождения векторов начальных моментов первого, второго и третьего моментов распределения  вероятностей  виртуального и актуального времени ожидания для системы $BMAP/D/1$.

\begin{figure}[htb] \centering
\includegraphics[scale=0.45]{img/graph.jpg}
\caption[]
{Граф переходов ЦМ с подписанными интенсивностями перехода}
\end{figure}

\newpage


%-------------------------------------- Описание системы ----------------------------------------

\subsection{Формулы для вычисления моментов}

{\bf Моменты виртуального времени ожидания}


\begin{itemize}

\item [$\bullet$] ${\bf w}_r$ вектор размера $(W+1)$ $r$-х начальных моментов виртуального времени ожидания, $r = \overline{0, 3}$;

\item [$\bullet$] $\hat{{\bf e}} = (1, 0, ...,0)$;

\item [$\bullet$] $\tilde{I}$ диагональная матрица с диагональными элементами $(0, 1, ... , 1)$;

\item [$\bullet$] $A_0=D(1)$;

\item [$\bullet$] $A_1=-D'(1)b_1$;

\item [$\bullet$] $A_2=\frac{1}{2}[D''(1)b_{1}^{2}+D'(1)b_2]$;

\item [$\bullet$] $A_3=-\frac{1}{6}[D^{(3)}(1)b_{1}^{3}+3D''(1)b_1b_2+D'(1)b_3]$;

\item [$\bullet$] $A_4=\frac{1}{24}[D^{(4)}(1)b_{1}^{4}+6D^{(3)}(1)b_{1}^{2}b_2+4D''(1)b_{1}b_{3}+3D''(1)b^{2}_{2}+D'(1)b_4]$;

\item [$\bullet$] $A=A_0\tilde{I}+(I+A_1){\bf e\hat{e}}$
\end{itemize}

Векторы ${\bf W}_r, \overline{0, 3}$, высчитываются по следующим рекурсивным формулам
$${\bf w}_0 = {\bf \theta},$$
$${\bf w}_1 = \Big\{[{\bf w}_0(I+A_1)-{\bf p}_0]\tilde{I}+{\bf w}_0A_2{\bf e\hat{e}}\Big\}A^{-1},$$
$${\bf w}_2= -2\Big\{[{\bf w}_0A_2-{\bf w}_1(I+A_1)]\tilde{I}+({\bf w}_0A_3-{\bf w}_1A_2){\bf e\hat{e}}\Big\}A^{-1},$$
$${\bf w}_3=3\Big\{[2{\bf w}_0A_3-2{\bf w}_1A_2+{\bf w}_2(I+A_1)]\tilde{I}+(2{\bf w}_0A_4-2{\bf w}_1A_3+{\bf w}_2A_2){\bf e\hat{e}}\Big\}A^{-1}.$$


{\bf Моменты актуального времени ожидания}

Дополнительно будем использовать
$v_r$ – $r$-й начальный момент актуального времени ожидания, $r=\overline{0,3}$;
Будем рассчитывать значения $v_r$, используя приведенные выше выражения для векторов $w_r$ и следующие рекурсивные формулы:
$$v_0=1,$$
$$v_1=\rho^{-1}[({\bf w}_0A_2-{\bf w}_1A_1){\bf e}-\frac{\lambda{b_2}}{2}],$$
$$v_2=\rho^{-1}[(-2{\bf w}_0A_3+2{\bf w}_1A_2-{\bf w}_2A_1){\bf e}-v_0\frac{\lambda{b_3}}{3}-v_1\lambda{b_2}],$$
$$v_3=\rho^{-1}[(6{\bf w}_0A_4-6{\bf w}_1A_3+3{\bf w}_2A_2-{\bf w}_3A_1){\bf e}-\lambda(v_0\frac{b_4}{4}-v_1b_3+\frac{3}{2}v_2b_2)].$$
{\bf Начальные конечные моменты времени обслуживания}

\begin{itemize}

\item [$\bullet$] Вырожденное распределение

$$b_k=T^k, k\geq1$$

\item [$\bullet$] Равномерное распределение

$$b_k=\frac{T_2^{k+1}-T_1^{k+1}}{(k+1)(T_2-T_1)}, k\geq1$$
\end{itemize}


\newpage


\subsection{Описание решения}

Инфинитезимальный генератор процесса $\nu_t, t\geq0$ имеет вид
 $$D(1)=D_0+D_1+D_2=\left(
    \begin{array}{cccc}
    -0,45& 0,2& 0,15& 0,1\\
    0,2& -0,6& 0,1& 0,3\\
    0,2& 0,1& -0,7& 0,4\\
    0,1& 0,05& 0,15& -0,3\\
    \end{array}
    \right),$$
    
 Вектор-строку стационарного распределения $\theta$ найдем из системы уравнений:
 
$$\begin{cases} 
\theta{D(1)}=0\\
\theta{\bf e}=1
\end{cases}$$

Получим, что 
$$\theta=(0,23870418; 0,14492754; 0,16794544; 0,44842285)$$

Вычисления будем проводить, предполагая, что время обслуживания запросов имеет равномерное распределение с параметрами $(0,1; 0,3)$.
Тогда начальные конечные моменты времени обслуживания равны
$$b_1=0,2,$$
$$b_2=0,0433,$$
$$b_3=0,01,$$
$$b_4=0,00242;$$

Найдем производные матричной производящей функции $D(1)$.

$$D^{(1)}(1)=\sum\limits_{k=0}^{\infty} kD_k$$
$$D^{(2)}(1)=\sum\limits_{k=0}^{\infty} k(k-1)D_k$$
$$D^{(3)}(1)=\sum\limits_{k=0}^{\infty} k(k-1)(k-2)D_k$$
$$D^{(4)}(1)=\sum\limits_{k=0}^{\infty} k(k-1)(k-2)(k-3)D_k$$

В нашем случае матрицы имеют вид

 $$D'(1)=\left(
    \begin{array}{cccc}
    1,5& 0& 0& 0\\
    0& 3& 0& 0\\
    0& 0& 4,5& 0\\
    0& 0& 0& 6\\
    \end{array}
    \right),
 D''(1)=\left(
    \begin{array}{cccc}
    1& 0& 0& 0\\
    0& 2& 0& 0\\
    0& 0& 3& 0\\
    0& 0& 0& 4\\
    \end{array}
    \right),    
    $$

$$D'''(1)=0, D^{(4)}(1)=0$$

\newpage

Интенсивность $BMAP$-потока $\lambda\approx4,23913043$, то есть в среднем в единицу времени в систему поступает 4,239 запросов.

Условие эргодичности нашей системы имеет вид:
$$\rho=\lambda{b_1}<1$$

В нашем случае 
$$\rho\approx0,84782609$$
Поэтому цепь обладает стационарным распределением.

Вычисленные матрицы $A_i, i=\overline{1,4}$ имеют вид
$$A_0=\left(
    \begin{array}{cccc}
    -0,45& 0,2& 0,15& 0,1\\
    0,2& -0,6& 0,1& 0,3\\
    0,2& 0,1& -0,7& 0,4\\
    0,1& 0,05& 0,15& -0,3\\
    \end{array}
    \right),$$
    
	$$A_1=\left(
    \begin{array}{cccc}
    -0,3& 0& 0& 0\\
    0& -0,6& 0& 0\\
    0& 0& -0,9& 0\\
    0& 0& 0& -1,2\\
    \end{array}
    \right),$$    
    
    $$A_2=\left(
    \begin{array}{cccc}
    0,0525& 0& 0& 0\\
    0& 0,105& 0& 0\\
    0& 0& 0,1575& 0\\
    0& 0& 0& 0,21\\
    \end{array}
    \right),$$
        
    $$A_3=\left(
    \begin{array}{cccc}
    -0,0068& 0& 0& 0\\
    0& -0,0137& 0& 0\\
    0& 0& -0,0205& 0\\
    0& 0& 0& -0,0028\\
    \end{array}
    \right),$$
    
    $$A_4=\left(
    \begin{array}{cccc}
    0.00071931& 0& 0& 0\\
    0& 0.00143861& 0& 0\\
    0& 0& 0.00215792& 0\\
    0& 0& 0& 0.00287722\\
    \end{array}
    \right),$$
    
    Вычисленные векторы моментов виртуального времени ожидания

$${\bf w}_0=(0,23870418; 0,14492754; 0,16794544; 0,44842285)$$
$${\bf w}_1=(0,37431255; 0,25160096; 0,38813528; 1,26551566)$$
$${\bf w}_2=(2,10506623; 1,39041998; 2,18233186; 7,31703072)$$
$${\bf w}_3=(18,14167521; 11,94081791; 18,75087968; 63,1835809)$$

$$w_0=1$$
$$w_1=2.27956444$$
$$w_2=12.99484878$$
$$w_3=112.01695371$$

Моменты актуального времени ожидания

$$v_1=2,5803837$$
$$v_2=14,75150774$$
$$v_3=127,19627658$$
\newpage

\section{Численные эксперименты}

Целью проведения эксперимента прежде всего является визуализация поведения системы при изменении параметров. Численные результаты находятся в приложении.

{\bf Эксперимент 1}

В первом эксперименте исследуем динамику моментов виртуального и актуального времени от разности параметров равномерного распределения при фиксированном $T_1$ 
 
 Из графиков следует, что с увеличением конечных начальных моментов обслуживания увеличиваются и моменты виртуального и актуального времени ожидания.

 
 \begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_1}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_4}}
\end{minipage}
\label{ris:image1}
\end{figure}

 \begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_2}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_5}}
\end{minipage}
\label{ris:image1}
\end{figure}

\begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_3}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot1_6}}
\end{minipage}

\label{ris:image1}
\end{figure}
 

\newpage



{\bf Эксперимент 2}

Во втором эксперименте рассмотрим зависимость моментов виртуального и актуального времени от интенсивности входного потока $\lambda$.
 
 Как видно из графиков, с увеличением интенсивности входного потока увеличиваются и моменты ожидания. Что логично: увеличение количества клиентов в единицу времени влечет большее время ожидания до конца обслуживания.
 
 \begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_1}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_4}}
\end{minipage}
\label{ris:image1}
\end{figure}

 \begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_2}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_5}}
\end{minipage}
\label{ris:image1}
\end{figure}

\begin{figure}[h]
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_3}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.5\linewidth}
\center{\includegraphics[width=1\linewidth]{img/plot2_6}}
\end{minipage}

\label{ris:image1}
\end{figure}
 

\newpage



\newpage
\newpage

%-------------------------------------- ЗАКЛЮЧЕНИЕ ----------------------------------------

\begin{center} {\bf {ЗАКЛЮЧЕНИЕ}} \end{center}

В спецлабораторной были проведены вычисления моментов виртуального и актуального времени ожидания системы BMAP/G/1. В качестве распределений времени обслуживания заявок были рассмотрены равномерное и вырожденное.
Реализован алгоритм нахождения моментов виртуального и актуального моментов на языках программирования Python и Wolfram Mathematica (смотри приложение). Проведены численные эксперименты для исследования поведения системы в зависимости от некоторых параметров.

\newpage

\section{Приложение}


\subsection{Реализация на языке Mathematica}


\begin{lstlisting}
(*вектор -строка П(0)*)(pi0={{0.0248761, 0.0151245, 
0.0107544 ,0.0163052 }})//MatrixForm

(*матрица D0*)d0 = { 
{-1.45, 0.2, 0.15, 0.1}, 
{0.2 , - 2.6, 0.1, 0.3},
{0.2, 0.1 , - 3.7, 0.4},
{0.1, 0.05, 0.15, - 4.3}
};

(*матрица D1*)d1 = DiagonalMatrix [{0.5, 1, 1.5, 2}];
(*матрица D2*)d2 = DiagonalMatrix [{0.5, 1, 1.5, 2}];
(*Инфинитезимальный генератор D(1)процесса
\nu_t , t>=0*)(dGenerator1 = d0+d1+d2)//MatrixForm
(*единичный вектор-столбец*)e={{1},
{1},
{1},
{1}};
(*вектор -строка e^*)e1 = {{1, 0, 0, 0}};
(*матрица I^*)i1 = DiagonalMatrix [{0, 1, 1, 1}];
(*матрица I*)i = DiagonalMatrix [{1, 1, 1, 1}];
(*производные матричной производящей функции в точке z=1*) 
(dDer1 = d1 + 2 d2 ) // MatrixForm ;
(dDer2 = 2 d2 ) // MatrixForm ;
(dDer3 = dDer4 = ConstantArray [0, {4, 4}] ) // MatrixForm ;
(*рассматривается равномерное распределение с параметрами T1,T2*)
T1 = 0;
T2 = 0.4;

(*начальные моменты b_i*)
(b = Table[(T2^(j + 1) - T1^(j + 1)) / ((j + 1) 
(T2 - T1)), {i, 1, 1}, {j, 1, 4}]) // MatrixForm

(*матрица A0*)(a0 = dGenerator1 ) // MatrixForm

(*матрица A1*)(a1 = - dDer1 * b[[1, 1]]) // MatrixForm

(*матрица A2*)(a2 = -1/2 *( dDer2 * b[[1, 1]]^2+
dDer1 * b[[1,2 ])) // MatrixForm

(*матрица A3*)(a3 = -1 / 6 * (dDer3 * b[[1, 1]]^3 + 3 * dDer2 * 
b[[1, 1]] * b[[1, 2]] + dDer1 * b[[1, 3]])) // MatrixForm

(*матрица A4*)
(a4=1/24 *(dDer4*b[[1,1]]^4+
6dDer3*b[[1,1]]^2*b[[1,2]]+4*dDer2*b[[1,1]]*b[[1,3]]+
3 * dDer2 * b[[1, 2]] ^ 2 + dDer1 * b[[1, 4]])) // MatrixForm

(*матрица A*)(a = a0.i1 + (i + a1).e.e1) // MatrixForm

(tempMatrix = Append [Transpose [dGenerator1 ], 
Transpose [e][[1]]]) // MatrixForm

(theta = {LinearSolve [tempMatrix , {0, 0, 0, 0, 1}]}) // MatrixForm

lambda = (theta .dDer1 . e)[[1, 1]]

rho = lambda * b[[1, 1]]

(p0 = lambda * pi0 .Inverse [- d0]) // MatrixForm

(w0 = theta) // MatrixForm

(w1 = ((w0.(i + a1) - p0).i1 + w0.a2.e.e1).Inverse [a]) // MatrixForm

(w2 = - 2 ((w0.a2 - w1.(i + a1)).i1 + (w0.a3 - w1.a2).e.e1).Inverse [a]) 
// MatrixForm

(w3 = 3 ((2 w0.a3 - 2 w1.a2 + w2.(i + a1)).i1 + (2 w0.a4 - 
2 w1.a3 + w2.a2).e.e1).Inverse [a]) // MatrixForm

(w = {w0[[1]], w1[[1]], w2[[1]], w3[[1]]}) // MatrixForm

v = {{0, 0, 0, 0}};

(*v0*)v[[1, 1]] = 1

(*v1*)v[[1, 2]] = (1 / rho * ((w0.a2 - w1.a1).e - 
lambda * b[[1, 2]] / 2))[[1, 1]]

(*v2*)v[[1, 3]] = (1 / rho * ((- 2 w0.a3 + 2 w1.a2 - w2.a1).e -
v[[1, 1]] * lambda * b[[1, 3]] / 3 - v[[1, 2]] * lambda * 
b[[1, 2]]))[[1, 1]]

(*v3*)v[[1, 4]] = (1 / rho * ((6 w0.a4 - 6 w1.a3 + 3 w2.a2 - 
w3.a1).e -lambda * (v[[1, 1]] * b[[1, 4]] / 4 + v[[1, 2]] * b[[1, 3]] + 
3 * v[[1, 3]] * b[[1, 2]] / 2)))[[1, 1]]

v // MatrixForm

\end{lstlisting}

\newpage

\subsection{Реализация на языке Python}

\begin{lstlisting}
import numpy as np
import sys

def antidurak(D_1):
    durak = False
    e=np.finfo(float).eps
    for x in D_1.sum(axis=1):
        durak = durak or (x > e)
    for x in D_1.diagonal().tolist()[0]:
        durak = durak or (x > 0)
    return bool(durak)

def find_theta(matr, e):
    D_1e = np.concatenate((matr.transpose(), e.transpose()))
    c = np.concatenate((np.zeros([n,1]), np.matrix(1)))
    theta = np.linalg.lstsq(a = D_1e, b = c,rcond=None)
    theta = theta[0].reshape((1, n))
    return theta

def find_degenerative(T):
    b=[]
    for i in range(4):
        b.append(T**(i+1))
    return b

def find_b(T1, T2):
    b = []
    for i in range(1, 5):
        b.append((T2**(i + 1) - T1**(i + 1)) / ((i+1) * (T2 - T1)))
    return b 

def find_dD(D, D_1):
    dD = []
    dD.append(D_1)
    for i in range(4):
        dD.append(np.matrix(np.zeros([n,n])))
    for index, matrix in enumerate(D):
        dD[1] += index * matrix
        dD[2] += index * (index - 1) * matrix
        dD[3] += index * (index - 1) * (index - 2) * matrix
        dD[4] += index * (index - 1) * (index - 2) * (index - 3) * matrix
    return dD

def find_A(d_mtrx, b):
    A = []
    A.append(d_mtrx[0])
    A.append(-d_mtrx[1] * b[0])
    A.append((d_mtrx[2] * b[0]**2 + d_mtrx[1] * b[1])/2)
    A.append(-(d_mtrx[3] * b[0]**3 + 3 * d_mtrx[2] * b[0] * b[1] + 
    d_mtrx[1] * b[2])/6)
    A.append((d_mtrx[4] * b[0]**4 + 6 * d_mtrx[3] * b[0]**2 * b[1] +
     4 * d_mtrx[2] * b[0] * b[2] + 3 * d_mtrx[2] * b[1]**2 + 
     d_mtrx[1] * b[3])/24)
    return A

def find_wr(mtrx, b, lmbd, pi0, I_, I, A, A_):
    p0 = lmbd * pi0 * np.linalg.inv(-mtrx[0])
    w = []
    w.append(theta)
    A_inv = np.linalg.inv(A_)
    w.append(((w[0] * (I + A[1]) - p0) * I_ + 
    w[0] * A[2] * e * e_) * A_inv)
    w.append(-2 * ((w[0] * A[2] - w[1] * (I + A[1])) * I_ + 
    (w[0] * A[3] -  w[1] * A[2]) * e * e_) * A_inv)
    w.append(3 * ((2 * w[0] * A[3] - 2 * w[1] * A[2] + 
    w[2] * (I + A[1])) * I_ + (2 * w[0] * A[4] - 2 * w[1] * A[3] + 
    w[2] * A[2]) * e * e_) * A_inv)
    return w

def find_v(w, A, lmbd, b, rho):
    v = []
    v.append(np.matrix([1]))
    v.append(((w[0] * A[2] - w[1] * A[1]) * e - lmbd * b[1] / 2)/rho)
    v.append(((-2 * w[0] * A[3] + 2 * w[1] * A[2] - w[2] * A[1]) * e -
              v[0] * lmbd * b[2] / 3 - v[1] * lmbd * b[1]) / rho) 
    v.append(((6 * w[0] * A[4] - 6 * w[1] * A[3] + 3 * w[2] * A[2] - 
    w[3] * A[1]) * e - lmbd * (v[0] * b[3] / 4 + v[1] * b[2] + 
    3 * v[2] * b[1] / 2)) / rho)
    return v

def find_rho(lmbd, b):
    return lmbd * b[0]

if __name__ == "__main__":
    task = open("task.txt", "r")
    n = int(task.readline())
    k = int(task.readline())
    D = []
    for j in range(k):
        line = task.readline()
        D.append(np.matrix(line))
    T1 = float(task.readline())
    T2 = float(task.readline())
    pi0 = np.matrix(task.readline())
    e = np.full([n,1], 1)
    e_ = np.full([n,1], 0)
    e_[0] = 1
    I_ = np.matrix(np.diag((e-e_).transpose()[0]))
    I = np.matrix(np.diag(e.transpose()[0]))
    e_ = e_.transpose()
    D_1 = sum(D)
    if(antidurak(D_1)):
        sys.exit("D(1) isn't a generator")
    theta = find_theta(D_1, e)
    dD = []
    dD.append(D_1)
    dD = find_dD(D, D_1)
    b = find_b(T1, T2)
    lambda_ = theta * dD[1] * e
    A = find_A(dD, b)
    A_ = A[0] * I_ + (I + A[1]) * e * e_
    w = find_wr(D, b, lambda_, pi0, I_, I, A, A_)
    rho = find_rho(lambda_, b)
    v = find_v(w, A, lambda_, b, rho)
    print(v)
    print(w)
    
\end{lstlisting}

{\bf Пример входного файла для скрипта} \\
1-ая строка -- число $n$ (размерность матриц $D_k$);\\
2-ая строка -- число $k$ (количество матриц $D_k$);\\ 
Затем $k$ строк с элементами матриц $D_k$;\\
(k+3)-яя строка -- первый параметр равномерного распределения;\\
(k+4)-яя строка -- второй параметр равномерного распределения;\\
(k+5)-яя строка -- ветор ${\bf \pi}_0$;\\

{\bf task.txt} \\
4\\
3\\
-1.45 0.2 0.15 0.1; 0.2 -2.6 0.1 0.3; 0.2 0.1 -3.7 0.4; 0.1 0.05 0.15 -4.3\\
0.5 0 0 0; 0 1 0 0; 0 0 1.5 0; 0 0 0 2\\
0.5 0 0 0; 0 1 0 0; 0 0 1.5 0; 0 0 0 2\\
0.1\\
0.3\\
0.0248761,0.0151245,0.0107544,0.0163052\\

\newpage

\subsection{Таблицы результатов}

{\bf Таблица 1}

\begin{tabular}{| c | c | c | c | c | c | c |}
\hline
$T_2-T_1$	&	$w_1$	&	$w_2$	&	$w_3$	&	$v_1$	&	$v_2$	&	$v_3$	\\ \hline

0.15	&	0.54892	&	1.80262	&	5.35169	&	0.64708	&	2.29764	&	6.54864	\\
0.15452	&	0.63703	&	2.09521	&	7.09336	&	0.75352	&	2.63381	&	8.66506	\\
0.15904	&	0.73379	&	2.45311	&	9.32412	&	0.8686	&	3.0445	&	11.34329	\\
0.16356	&	0.8403	&	2.89043	&	12.19822	&	0.99343	&	3.54489	&	14.75622	\\
0.16808	&	0.95781	&	3.4248	&	15.92279	&	1.12927	&	4.15385	&	19.13431	\\
0.1726	&	1.08785	&	4.07844	&	20.77822	&	1.27763	&	4.89504	&	24.78757	\\
0.17712	&	1.2322	&	4.87956	&	27.14776	&	1.44031	&	5.79845	&	32.13703	\\
0.18164	&	1.39302	&	5.86438	&	35.56071	&	1.61945	&	6.90234	&	41.76073	\\
0.18616	&	1.57292	&	7.07982	&	46.75682	&	1.81767	&	8.25621	&	54.4619	\\
0.19068	&	1.77508	&	8.58747	&	61.78371	&	2.03815	&	9.92472	&	71.37185	\\
0.1952	&	2.00344	&	10.4691	&	82.14724	&	2.28485	&	11.9935	&	94.10821	\\
0.19973	&	2.26295	&	12.8352	&	110.04867	&	2.56268	&	14.57777	&	125.02361	\\
0.20425	&	2.55986	&	15.8369	&	148.76748	&	2.87791	&	17.83478	&	167.60597	\\
0.20877	&	2.9022	&	19.6855	&	203.29658	&	3.23858	&	21.98359	&	227.14052	\\
0.21329	&	3.30053	&	24.6823	&	281.42855	&	3.65522	&	27.33568	&	311.83849	\\
0.21781	&	3.76889	&	31.2673	&	395.67949	&	4.14191	&	34.34487	&	434.83015	\\
0.22233	&	4.3265	&	40.1022	&	566.83617	&	4.71784	&	43.69137	&	617.82898	\\
0.22685	&	5.00029	&	52.2147	&	830.81104	&	5.40996	&	56.42912	&	898.19264	\\
0.23137	&	5.82925	&	69.266	&	1252.64782	&	6.25724	&	74.25699	&	1343.30894	\\
0.23589	&	6.872	&	94.0719	&	1957.11435	&	7.31832	&	100.0478	&	2081.93387	\\

\hline
\end{tabular}

\vfill
{\bf Таблица 2}

\begin{tabular}{| c | c | c | c | c | c | c |}
\hline
$\lambda$	&	$w_1$	&	$w_2$	&	$w_3$	&	$v_1$	&	$v_2$	&	$v_3$	\\ \hline
4.0,	&	1.32085	&	5.58195	&	33.20914	&	1.54273	&	6.62651	&	39.27764	\\
4.0421	&	1.45493	&	6.41735	&	40.725	&	1.69139	&	7.55499	&	47.833	\\
4.08421	&	1.60135	&	7.40556	&	50.10726	&	1.85208	&	8.64814	&	58.43638	\\
4.12631	&	1.76188	&	8.5791	&	61.90399	&	2.02659	&	9.93983	&	71.67641	\\
4.16842	&	1.93866	&	9.9793	&	76.85403	&	2.21708	&	11.473	&	88.34338	\\
4.21052	&	2.1343	&	11.65938	&	95.96662	&	2.42615	&	13.30318	&	109.51249	\\
4.25263	&	2.35198	&	13.68859	&	120.6405	&	2.657	&	15.50191	&	136.66817	\\
4.29473	&	2.59566	&	16.15835	&	152.84577	&	2.91358	&	18.16387	&	171.89348	\\
4.33684	&	2.87028	&	19.19119	&	195.40771	&	3.20085	&	21.41559	&	218.16488	\\
4.37894	&	3.18214	&	22.95409	&	252.46086	&	3.52512	&	25.42915	&	279.82285	\\
4.42105	&	3.53935	&	27.67903	&	330.19607	&	3.89451	&	30.44319	&	363.34425	\\
4.46315	&	3.95261	&	33.6955	&	438.12892	&	4.3197	&	36.7959	&	478.65071	\\
4.50526	&	4.4362	&	41.48332	&	591.33238	&	4.81502	&	44.97881	&	641.40652	\\
4.54736	&	5.00976	&	51.76197	&	814.53459	&	5.40008	&	55.72752	&	877.22648	\\
4.58947	&	5.70098	&	65.64809	&	1150.01468	&	6.10259	&	70.18139	&	1229.76586	\\
4.63157	&	6.55018	&	84.94734	&	1673.72158	&	6.96289	&	90.17922	&	1777.1991	\\
4.67368	&	7.61854	&	112.72895	&	2530.55082	&	8.04214	&	118.84053	&	2668.20512	\\
4.71578	&	9.00345	&	154.54376	&	4018.45243	&	9.43774	&	161.79627	&	4207.57725	\\
4.75789	&	10.87007	&	221.25874	&	6811.89722	&	11.3148	&	230.04927	&	7083.18553	\\
4.8	&	13.52263	&	336.50641	&	12646.13668	&	13.9777	&	347.48233	&	13059.42537	\\


\hline
\end{tabular}


\end{document} 